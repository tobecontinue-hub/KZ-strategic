{% extends "base.html" %}
{% block content %}
<style>
  .org-wrapper {
    padding: 2rem 1rem;
    overflow-x: auto;
  }
  .org-tree {
    list-style: none;
    padding-left: 0;
    display: flex;
    gap: 1.5rem;
    flex-wrap: wrap;
    justify-content: center;
  }
  .org-tree ul {
    list-style: none;
    padding-left: 1.5rem;
    border-left: 1px solid #e2e8f0;
    margin-top: 1rem;
  }
  .org-card {
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 8px 20px rgba(15, 23, 42, 0.08);
    padding: 1rem;
    min-width: 220px;
    max-width: 280px;
    border-top: 4px solid #3b82f6;
  }
  .org-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }
  .org-photo {
    width: 56px;
    height: 56px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid #e2e8f0;
  }
  .org-placeholder {
    width: 56px;
    height: 56px;
    border-radius: 50%;
    background: #e0e7ff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    color: #312e81;
  }
  .org-name {
    font-weight: 700;
    margin-bottom: 0.1rem;
    color: #0f172a;
  }
  .org-role {
    font-size: 0.85rem;
    color: #475569;
  }
  .org-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 0.75rem;
    font-size: 0.8rem;
    color: #475569;
  }
  .badge {
    padding: 0.15rem 0.5rem;
    border-radius: 999px;
    font-size: 0.7rem;
    font-weight: 600;
  }
  .badge--status {
    background: #e0f2fe;
    color: #0369a1;
  }
  .badge--vacant {
    background: #fee2e2;
    color: #b91c1c;
  }
  .department-label {
    font-weight: 600;
    color: #64748b;
  }
</style>

{% macro render_node(node) %}
  <li>
    <div class="org-card">
      <div class="org-header">
        {% if node.photo_url %}
          <img class="org-photo" src="{{ node.photo_url }}" alt="{{ node.original_name or node.name }}" onerror="this.style.display='none'">
        {% else %}
          <div class="org-placeholder">{{ (node.original_name or node.name)[:1] }}</div>
        {% endif %}
        <div>
          <div class="org-name">{{ node.original_name or node.name }}</div>
          <div class="org-role">{{ node.role or 'Role TBD' }}</div>
        </div>
      </div>
      <div class="org-meta">
        <span class="department-label">{{ node.department or 'Department' }}</span>
        <span class="badge {{ 'badge--vacant' if (node.status|default('')).lower() == 'vacant' else 'badge--status' }}">
          {{ node.status or 'Status N/A' }}
        </span>
      </div>
    </div>
    {% if node.children %}
      <ul>
        {% for child in node.children %}
          {{ render_node(child) }}
        {% endfor %}
      </ul>
    {% endif %}
  </li>
{% endmacro %}

<div class="org-wrapper">
  <h2 class="text-center mb-4">Organizational Structure</h2>
  <ul class="org-tree">
    {% for node in root_nodes %}
      {{ render_node(node) }}
    {% endfor %}
  </ul>
</div>
{% endblock %}
