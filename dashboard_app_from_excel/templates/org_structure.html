{% extends "base.html" %}
{% block content %}
<style>
  .org-wrapper{max-width:1200px;margin:0 auto;padding:1rem 1rem 3rem;color:#0f172a}
  .org-wrapper h2{text-align:center;font-weight:800;margin-bottom:.3rem}
  .org-wrapper p.subhead{text-align:center;color:#64748b;letter-spacing:0.3em;text-transform:uppercase;font-size:0.75rem;margin-bottom:1.5rem}
  .lane{position:relative;padding-top:2rem;margin-bottom:2.5rem}
  .lane::before{content:"";position:absolute;top:0;left:calc(50% - 1px);width:2px;height:100%;background:linear-gradient(180deg,#cbd5f5,#e0e7ff)}
  .lane-label{position:absolute;top:0;left:50%;transform:translate(-50%,-50%);padding:0.2rem 0.75rem;border-radius:999px;font-size:0.7rem;font-weight:600;color:#fff;background:#312e81;box-shadow:0 4px 15px rgba(49,46,129,.25)}
  .lane-grid{display:flex;flex-wrap:wrap;justify-content:center;gap:1rem;margin-top:0.5rem}
  .member-card{min-width:200px;max-width:240px;padding:0.9rem 1rem;border-radius:14px;background:#fff;box-shadow:0 12px 30px rgba(15,23,42,.12);position:relative;transition:transform .2s,box-shadow .2s}
  .member-card:hover{transform:translateY(-4px);box-shadow:0 18px 40px rgba(15,23,42,.16)}
  .member-card::before{content:"";position:absolute;top:-30px;left:50%;width:2px;height:30px;background:linear-gradient(180deg,#cbd5f5,#94a3b8)}
  .member-card .photo{width:56px;height:56px;border-radius:50%;overflow:hidden;border:3px solid rgba(148,163,184,.4);background:#e2e8f0;margin-bottom:.5rem}
  .member-card img{width:100%;height:100%;object-fit:cover;display:block}
  .member-card .name{font-weight:700;margin-bottom:.1rem}
  .member-card .role{font-size:.85rem;color:#475569;margin-bottom:.3rem}
  .member-card .meta{display:flex;gap:.3rem;flex-wrap:wrap;font-size:.7rem}
  .badge{padding:.15rem .45rem;border-radius:999px;background:#f1f5f9;color:#475569;font-weight:600}
  .badge.status-vacant{background:#fee2e2;color:#b91c1c}
  .badge.status-active{background:#dcfce7;color:#15803d}
  .lane:first-of-type .member-card::before{display:none}
  @media(max-width:768px){.lane::before{display:none}.member-card::before{display:none}}
</style>

{% set grouped = {'CEO': [], 'Head': [], 'Asst Manager': [], 'Exec+Dev': [], 'Staff+Junior': []} %}
{% for node in root_nodes %}
  {% set key = node.role|lower %}
  {% if 'ceo' in key %}
    {% set _ = grouped['CEO'].append(node) %}
  {% elif 'head' in key %}
    {% set _ = grouped['Head'].append(node) %}
  {% elif 'asst' in key or 'assistant' in key %}
    {% set _ = grouped['Asst Manager'].append(node) %}
  {% elif 'executive' in key or 'developer' in key %}
    {% set _ = grouped['Exec+Dev'].append(node) %}
  {% else %}
    {% set _ = grouped['Staff+Junior'].append(node) %}
  {% endif %}
{% endfor %}

<div class="org-wrapper">
  <p class="subhead">Structure</p>
  <h2>Organization Tree</h2>
  {% for label, members in grouped.items() %}
    {% if members %}
    <section class="lane">
      <div class="lane-label">{{ label }}</div>
      <div class="lane-grid">
        {% for member in members %}
        <article class="member-card">
          <div class="photo">
            {% if member.photo_url %}
              <img src="{{ member.photo_url }}" alt="{{ member.original_name or member.name }}" onerror="this.remove();">
            {% else %}
              <div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-weight:700;color:#475569;">
                {{ (member.original_name or member.name)[:1] }}
              </div>
            {% endif %}
          </div>
          <div class="name">{{ member.original_name or member.name }}</div>
          <div class="role">{{ member.role or 'Role TBD' }}</div>
          <div class="meta">
            <span class="badge">{{ member.department or 'Department' }}</span>
            {% set status = member.status or '' %}
            <span class="badge {{ 'status-vacant' if 'vacant' in status|lower else 'status-active' }}">{{ status or 'Status' }}</span>
          </div>
        </article>
        {% endfor %}
      </div>
    </section>
    {% endif %}
  {% endfor %}
</div>
{% endblock %}
