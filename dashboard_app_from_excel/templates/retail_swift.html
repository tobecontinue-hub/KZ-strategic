{% extends "base.html" %}
{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

<style>
:root {
  --swift-bg: #0f172a;
  --swift-card: rgba(30, 41, 59, 0.78);
  --swift-border: rgba(148, 163, 184, 0.3);
  --swift-highlight: #38bdf8;
  --swift-secondary: #818cf8;
  --swift-success: #34d399;
  --swift-warning: #fbbf24;
  --swift-error: #f87171;
  --swift-info: #60a5fa;
}

.swift-shell {
  min-height: calc(100vh - 120px);
  background: radial-gradient(circle at top, rgba(56, 189, 248, 0.10), rgba(15, 23, 42, 0.95));
  padding: 40px 12px 80px;
}

.swift-card {
  max-width: 1400px;
  margin: 0 auto;
  background: rgba(2, 6, 23, 0.9);
  border-radius: 36px;
  border: 1px solid rgba(148, 163, 184, 0.25);
  box-shadow: 0 45px 130px rgba(2, 6, 23, 0.85);
  overflow: hidden;
}

.swift-hero {
  padding: 36px 40px 30px;
  border-bottom: 1px solid rgba(148, 163, 184, 0.2);
  background: linear-gradient(135deg, rgba(56, 189, 248, 0.2), rgba(99, 102, 241, 0.25));
  color: #f8fafc;
}

.swift-hero h1 {
  font-size: clamp(2.1rem, 3vw, 2.9rem);
  font-weight: 800;
  margin-bottom: 12px;
}

.swift-hero p {
  max-width: 820px;
  color: #cbd5f5;
  margin-bottom: 24px;
}

.swift-body {
  padding: 30px 40px 50px;
}

.swift-topic {
  background: var(--swift-card);
  border: 1px solid var(--swift-border);
  border-radius: 16px;
  margin-bottom: 24px;
  overflow: hidden;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.swift-topic:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
}

.topic-header {
  padding: 20px 25px;
  background: rgba(30, 41, 59, 0.8);
  border-bottom: 1px solid var(--swift-border);
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.topic-header h2 {
  margin: 0;
  font-size: 1.25rem;
  font-weight: 700;
  color: #f8fafc;
}

.topic-content {
  padding: 0;
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease, padding 0.3s ease;
}

.topic-content.active {
  padding: 25px;
  max-height: 5000px;
}

.topic-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
}

.topic-card {
  background: rgba(15, 23, 42, 0.6);
  border-radius: 12px;
  padding: 20px;
  border-left: 4px solid var(--swift-highlight);
}

.topic-card.what-worked {
  border-left-color: var(--swift-success);
}

.topic-card.what-needs-scale {
  border-left-color: var(--swift-warning);
}

.topic-card.what-not-worked {
  border-left-color: var(--swift-error);
}

.topic-card.lesson-learned {
  border-left-color: var(--swift-info);
}

.topic-card.new-ideas {
  border-left-color: var(--swift-secondary);
}

.card-header {
  display: flex;
  align-items: center;
  margin-bottom: 15px;
  padding-bottom: 12px;
  border-bottom: 1px solid rgba(148, 163, 184, 0.1);
}

.card-header i {
  font-size: 1.2rem;
  margin-right: 10px;
}

.card-header h3 {
  margin: 0;
  font-size: 1.1rem;
  font-weight: 600;
  color: #f8fafc;
}

.card-content {
  color: #e2e8f0;
  line-height: 1.6;
  font-size: 0.95rem;
}

.card-content p:last-child {
  margin-bottom: 0;
}

.swift-bullet-list {
  padding-left: 20px;
  margin: 0;
  list-style-type: disc;
}

.swift-bullet-list li {
  margin-bottom: 6px;
}

.swift-bullet-list li:last-child {
  margin-bottom: 0;
}

.next-goal {
  background: rgba(30, 41, 59, 0.8);
  padding: 25px;
  border-radius: 12px;
  margin-bottom: 25px;
  border-left: 4px solid var(--swift-highlight);
}

.next-goal h3 {
  color: var(--swift-highlight);
  margin-top: 0;
  margin-bottom: 15px;
  font-size: 1.2rem;
  display: flex;
  align-items: center;
  gap: 10px;
}

.next-goal p {
  margin: 0;
  font-size: 1.1rem;
  line-height: 1.6;
  color: #e2e8f0;
}

.toggle-icon {
  transition: transform 0.3s ease;
}

.toggle-icon.rotated {
  transform: rotate(180deg);
}

@media (max-width: 768px) {
  .swift-hero, .swift-body {
    padding: 26px;
  }
  
  .topic-grid {
    grid-template-columns: 1fr;
  }
}
</style>

{% macro render_bullets(text) %}
  {% if text %}
    <ul class="swift-bullet-list">
      {% for line in text.split('\n') %}
        {% if line.strip() %}
          <li>{{ line.strip() }}</li>
        {% endif %}
      {% endfor %}
    </ul>
  {% endif %}
{% endmacro %}

<div class="swift-shell">
  <div class="swift-card">
    <section class="swift-hero">
      <h1>Retail Swift Online Insights</h1>
    </section>
    
    <div class="swift-body">
      {% if data %}
        {% set topics = {} %}
        
        {% for item in data %}
          {% set topic = item['Topics'] %}
          {% if topic not in topics %}
            {% set _ = topics.update({topic: []}) %}
          {% endif %}
          {% set _ = topics[topic].append(item) %}
        {% endfor %}
        
        {% for topic, items in topics.items() %}
          {% if topic %}
            <div class="swift-topic">
              <div class="topic-header" onclick="toggleTopic(this)">
                <h2>{{ topic }}</h2>
                <i class="bi bi-chevron-down toggle-icon"></i>
              </div>
              
              <div class="topic-content">
                {% for item in items %}
                  {% if item['What is the NEXT goal?'] %}
                    <div class="next-goal">
                      <h3><i class="bi bi-bullseye"></i> Next Goal</h3>
                      <p>{{ item['What is the NEXT goal?'] }}</p>
                    </div>
                  {% endif %}
                  
                  <div class="topic-grid">
                    {% if item['What worked?'] %}
                      <div class="topic-card what-worked">
                        <div class="card-header">
                          <i class="bi bi-check-circle-fill" style="color: var(--swift-success);"></i>
                          <h3>What Worked</h3>
                        </div>
                        <div class="card-content">
                          {{ render_bullets(item['What worked?']) | safe }}
                        </div>
                      </div>
                    {% endif %}
                    
                    {% if item['What needs to scale?'] %}
                      <div class="topic-card what-needs-scale">
                        <div class="card-header">
                          <i class="bi bi-arrow-up-circle-fill" style="color: var(--swift-warning);"></i>
                          <h3>What Needs to Scale</h3>
                        </div>
                        <div class="card-content">
                          {{ render_bullets(item['What needs to scale?']) | safe }}
                        </div>
                      </div>
                    {% endif %}
                    
                    {% if item['What did NOT work?'] %}
                      <div class="topic-card what-not-worked">
                        <div class="card-header">
                          <i class="bi bi-x-circle-fill" style="color: var(--swift-error);"></i>
                          <h3>What Didn't Work</h3>
                        </div>
                        <div class="card-content">
                          {{ render_bullets(item['What did NOT work?']) | safe }}
                        </div>
                      </div>
                    {% endif %}
                    
                    {% if item['What is the lesson learned?'] %}
                      <div class="topic-card lesson-learned">
                        <div class="card-header">
                          <i class="bi bi-lightbulb-fill" style="color: var(--swift-info);"></i>
                          <h3>Lessons Learned</h3>
                        </div>
                        <div class="card-content">
                          {{ render_bullets(item['What is the lesson learned?']) | safe }}
                        </div>
                      </div>
                    {% endif %}
                    
                    {% if item['What new ideas should be validated next?'] %}
                      <div class="topic-card new-ideas">
                        <div class="card-header">
                          <i class="bi bi-lightning-charge-fill" style="color: var(--swift-secondary);"></i>
                          <h3>New Ideas to Validate</h3>
                        </div>
                        <div class="card-content">
                          {{ render_bullets(item['What new ideas should be validated next?']) | safe }}
                        </div>
                      </div>
                    {% endif %}
                  </div>
                {% endfor %}
              </div>
            </div>
          {% endif %}
        {% endfor %}
      {% else %}
        <div class="alert alert-warning">No data available for Retail Swift Online. Please check back later.</div>
      {% endif %}
    </div>
  </div>
</div>

<script>
function toggleTopic(header) {
  const content = header.nextElementSibling;
  const icon = header.querySelector('.toggle-icon');
  
  content.classList.toggle('active');
  icon.classList.toggle('rotated');
  
  // Close other open topics
  document.querySelectorAll('.topic-header').forEach(h => {
    if (h !== header && h.nextElementSibling.classList.contains('active')) {
      h.nextElementSibling.classList.remove('active');
      h.querySelector('.toggle-icon').classList.remove('rotated');
    }
  });
}

// Open first topic by default
document.addEventListener('DOMContentLoaded', function() {
  const firstTopic = document.querySelector('.topic-header');
  if (firstTopic) {
    firstTopic.click();
  }
});
</script>

{% endblock %}
